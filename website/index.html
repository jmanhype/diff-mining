<!DOCTYPE html>
<html>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<link rel="stylesheet" href="styles.css">

<head>
<title>Diff-Mining</title>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>
<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<link rel="icon" type="image/png" href="diffmining.png">
</head>

<body>

<h1>Diffusion Models as Data Mining Tools</h1>
<center>
  <div class="authors">
    <a href="https://imagine.enpc.fr/~siglidii/">Ioannis&nbspSiglidis</a><sup>1</sup>, <a href="https://holynski.org/">Aleksander&nbspHo≈Çy≈Ñski</a><sup>2</sup>,
    <a href="https://people.eecs.berkeley.edu/~efros/">Alexei&nbspA.&nbspEfros</a><sup>2</sup>, <br/>
    <a href="https://imagine.enpc.fr/~aubrym/">Mathieu&nbspAubry</a><sup>1</sup>,
    <a href="https://people.eecs.berkeley.edu/~shiry/">Shiry&nbspGinosar</a><sup>2</sup>
  </div>
  </div>
</center>

<div class="unis">
<sup>1</sup>LIGM,&nbspEcole&nbspdes&nbspPonts,&nbspUniv&nbspGustave&nbspEiffel,&nbspCNRS
<sup>2</sup>University&nbspof&nbspCalifornia,&nbspBerkeley
</center>
</div>

<!-- <div class="cvpr" style="margin-top: -0.5em; margin-bottom: 2.5em"><h2>CVPR 2024 (Poster)</h2></div> -->
<div class="publication-links">
  <span class="link-block">
    <a href="arxiv.pdf" class="external-link button is-normal is-rounded is-dark">
      <span class="icon">
        <i class="fa-regular fa-file-lines" style="margin-right: 0.5rem;"></i> Pdf
      </span>
    </a>
  </span>

  <span class="link-block">
    <a href="" class="external-link button is-normal is-rounded is-dark">
      <span class="icon">
        <i class="ai ai-arxiv"></i> Arxiv
      </span>
    </a>
  </span>

<!--   <span class="link-block">
    <a href="" class="external-link button is-normal is-rounded is-dark">
      <span class="icon">
        <i class="fa-solid fa-database" style="margin-right: 0.5rem;"></i> Data
      </span>
    </a>
  </span>
 -->

  <span class="link-block">
    <a href="https://github.com/gastruc/osv5m" class="external-link button is-normal is-rounded is-dark">
      <span class="icon">
        <i class="fa-brands fa-github" style="margin-right: 0.5rem;"></i> Code
      </span>
    </a>
  </span>

  <span class="link-block">
    <a href="supmat.html" class="external-link button is-normal is-rounded is-dark">
      <span class="icon">
          üöòüë©üñºÔ∏è
      </span>
    </a>
  </span>
</div>

<div class="image-container">
  <img src="media/Teaser.jpg" alt="Given a set of labelled data, we devise a method that ranks the most typical patches of these data and clusters them, leading in informative visual summaries." style="margin-top: 1em;">
</div>

<h2>Abstract</h2>
<div class="text">
This paper demonstrates how to use generative models as tools for data mining. Our insight is that contemporary generative models learn an accurate representation of their training data, facilitating their use for summarization and mining. Concretely, we show that after fine-tuning conditional diffusion models on a specific dataset, we can use these models to define a typicality measure on that dataset. This measure assesses how typical visual elements are for different tags, such as geographic location, time stamps, or even the presence of a disease. This analysis-by-synthesis approach to data mining has two key advantages. First, it scales much better than traditional correspondence-based approaches, since it does not require explicitly comparing all pairs of visual elements. Second, while most previous works on visual mining focus on a single dataset, it works on diverse datasets in terms of content and scale, including a historical car dataset, a historical face dataset, and a large worldwide Streetview dataset. We demonstrate that our method generalizes beyond standard images by showing that our typicality score enables the localization of anomalies related to thorax diseases on the X-ray images of the CXR8 dataset. Furthermore, our approach allows the analysis of visual elements across class labels.
</div>

<h2>Extracted Visual Elements</h2>

<div id="carouselExampleDark" class="carousel carousel-dark slide" style="margin-bottom: 2em; padding-bottom: 3em;">
  <div class="carousel-indicators" style="bottom: 3em;">
    <button type="button" data-bs-target="#carouselExampleDark" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
    <button type="button" data-bs-target="#carouselExampleDark" data-bs-slide-to="1" aria-label="Slide 2"></button>
    <button type="button" data-bs-target="#carouselExampleDark" data-bs-slide-to="2" aria-label="Slide 3"></button>
  </div>
  <div class="carousel-inner">
    <div class="carousel-item active" data-bs-interval="10000">
      <img src="visual-elements/g3.jpg" class="d-block w-100" alt="">
      <div class="carousel-caption d-none d-md-block" style="color: white;">
        <p><a href="https://arxiv.org/abs/2211.15521">G^3 (Luo et al. 2022)</a></p>
      </div>
    </div>
    <div class="carousel-item" data-bs-interval="2000">
      <img src="visual-elements/ftt.jpg" class="d-block w-100" alt="">
      <div class="carousel-caption d-none d-md-block" style="color: white;">
        <p><a href="https://facesthroughtime.github.io/">Faces Through Time (Chen et al. 2023)</a></p>
      </div>
    </div>
    <div class="carousel-item">
      <img src="visual-elements/cardb.jpg" class="d-block w-100" alt="">
      <div class="carousel-caption d-none d-md-block" style="color: white;">
        <p><a href="https://pages.cs.wisc.edu/~yongjaelee/projects/style_iccv2013.pdf">CarDB (Lee et al. 2013)</a></p>
      </div>
    </div>
  </div>
  <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleDark" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true" style="color: white;"></span>
    <span class="visually-hidden">Previous</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleDark" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true" style="color: white;"></span>
    <span class="visually-hidden">Next</span>
  </button>
</div>

<div class="text" style="margin-top: 2em; margin-bottom: 2em;">
  Using our approach, one can rank and cluster patches of a large image collection according to their label, by training through a generative model.
  For example out of a collection of images that concern geography our approach can extract 
</div>

<h2>Approach</h2>
<!-- <div class="image-container" style="margin-bottom: 1em;">
  <img src="media/benchmark.jpg" alt="Description of the image">
  <div class="caption">    
  </div>
</div>
 -->

<div id="carousel2" class="carousel carousel-dark slide" style="margin-bottom: 2em; padding-bottom: 7em;">
  <div class="carousel-indicators" style="bottom: 7em;">
    <button type="button" data-bs-target="#carousel2" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
    <button type="button" data-bs-target="#carousel2" data-bs-slide-to="1" aria-label="Slide 2"></button>
    <button type="button" data-bs-target="#carousel2" data-bs-slide-to="2" aria-label="Slide 3"></button>
  </div>
  <div class="carousel-inner">
    <div class="carousel-item active" data-bs-interval="10000">
      <img src="approach/finetuning.jpg" alt="Typicality visualized before and after finetuning across three datasets of faces cars and geo." class="d-block w-100">
      <div class="carousel-caption d-none d-md-block">
        <p><b>Typicality visualized before and after finetuning</b> reveals that after finetuning typicality become more focused in elements of the image that relevant according to the model.</p>
      </div>
    </div>
    <div class="carousel-item" data-bs-interval="2000">
      <img src="approach/ranking.jpg" class="d-block w-100" alt="Patches from three datasets of faces, cars and geo ranked according to random, typicality and negative typicality.">
      <div class="carousel-caption d-none d-md-block">
        <p><b>Ranking patches according to typicality</b> $\mathbf{T}$ is clearly more informative of the input label in comparison to random. Interestingly negative typicality, reveals patches that are either not typical of their time of uninformative.</p>
      </div>
    </div>
    <div class="carousel-item">
      <img src="approach/limitations.jpg" class="d-block w-100" alt="Limitations">
      <div class="carousel-caption d-none d-md-block">
        <p><b>Limitations</b> of our method include the standard limitations of clustering for example mixed clusters <b>(a)</b> or finding typical elements that correspond to artifacts <b>(b)</b>. Although they don't offer informative elements for analyzing our target dataset, such artifacts are used to shortcut identifying See the Nigerian bars car here.</p>
      </div>
    </div>
  </div>
  <button class="carousel-control-prev" type="button" data-bs-target="#carousel2" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Previous</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#carousel2" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Next</span>
  </button>
</div>

<div class="text" style="margin-top: 0em; margin-bottom: 2em; text-align: left;">
  <table>
  <tr>
    <td>1.&nbsp<b>Finetuning</b></td>
    <td>üìâ</td>
    <td>Given labels $Y$, we finetune a standard a conditional latent diffusion model with a loss $L_{t}\left(x, \epsilon, c(Y)\right)$,where $c(Y)$ is a prompt of the form $c(Y) = \text{‚ÄüAn image of {Y}‚Äù}$.</td>
  </tr>

  <tr>
  <td>2.&nbsp<b>Ranking</b></td>
  <td>üõï</td>
  <td>Using a <it>typicality</it> score inspired by the work of <a href="https://diffusion-classifier.github.io/">Li et al. 2021</a>, and averaged in areas of the input image, we can derive a measure of how important a patch of the image is for a given conditioning: $\mathbf{T} (x|c) =  \mathbb{E}_{\epsilon,t}[L_t(x, \epsilon, \varnothing) - L_t(x, \epsilon, c)]$.</td>
  </tr>

  <tr>
  <td>3.&nbsp<b>Clustering</b></td>
  <td>üß´</td>
  <td>Having the most typical patches describing the image we cluster them using their <a href="https://diffusionfeatures.github.io/">DIFT-161</a> features, and rank clusters according to their median typicality.</td>
  </tr>
  </table>
</div>

<h2>Applications</h2>

<div id="carousel3" class="carousel carousel-dark slide" style="margin-bottom: 2em; padding-bottom: 9em;">
  <div class="carousel-indicators" style="bottom: 9em;">
    <button type="button" data-bs-target="#carousel3" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
    <button type="button" data-bs-target="#carousel3" data-bs-slide-to="1" aria-label="Slide 2"></button>
  </div>
  <div class="carousel-inner">
    <div class="carousel-item active" data-bs-interval="10000">
      <img src="applications/cotypicality.jpg" alt="" class="d-block w-100">
      <div class="carousel-caption d-none d-md-block">
        <p><b>Clustering Element Variations:</b> Ranking translations according to $\bar{\mathbf{T}}$ and clustering them in a joint manner results in groups of elements with similar variations. We can identify architectural elements, such as gables, roofs and windows (left), as well as others such as road tracks, electric poles and license plates (right). In each row, we highlight the original image with red.</p>
      </div>
    </div>
    <div class="carousel-item" data-bs-interval="2000">
      <img src="applications/xray.jpg" class="d-block w-100" alt="Visualization of typicality on frontal view X-ray showing improve localization after finetuning.">
      <div class="carousel-caption d-none d-md-block">
        <p><b>X-ray localization:</b> Alongside expert annotations on ChestX-ray8, we visualy compare fine-tuning (ft.) typicality that is visibly localized in comparison with pretrained (pt.) which is mostly noise.</p>
      </div>
    </div>
  </div>
  <button class="carousel-control-prev" type="button" data-bs-target="#carousel3" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Previous</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#carousel3" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Next</span>
  </button>
</div>

<div class="text" style="margin-top: 0em; margin-bottom: 2em; text-align: left;">
  <table>
  <tr>
    <td>1.&nbsp<b>Clustering variations of typical elements.</b></td>
    <td>üóÉÔ∏è</td>
    <td>A common goal of data mining is not only to locate informative parts of images inside a dataset, but also to find interesting connections across image parts. Using <a href="https://pnp-diffusion.github.io/">Plug and Play</a> on G^3, we translate input images from one location to all other locations. Then selecting typical translations, leads to selecting the top patches that maximize median typicality across translations, for all their respected categories, which we can then cluster by concatenating their dift-features. The result is typical translation of roofs, windows, gables and utility poles, or car license plates.</td>
  </tr>

  <tr>
  <td>2.&nbsp<b>Localizing diseases in X-rays.</b></td>
  <td>ü©ª</td>
  <td>As we noticed above Typicality, has the ability to localize and focus on relevant to the label parts of the image, after finetuning. This makes sense as it intimately related to a binary classifier that selects between $\varnothing$ and $c$. As such it would be meaningful to its performance in medical images, especially frontal view X-rays from the ChestX-ray8 dataset, all annotated with up to ten different diseases. After finetuning we notice a significant improvement in performance in localizing expert annotated areas in small test subset of 879 images from 7 diseases, in terms of AUC-PR.</td>
  </tr>
  </table>
</div>


<h2 style="margin-top: 1em;">Cite Us</h2>
<pre><code class="language-bibtex">
  @article{diff-mining,
    title = {},
    author = {},
    journal = {},
    year = {},
  }</code><button class="copy-code-button"><i class="fa-regular fa-clone"></i></button>
</pre>

<h2 style="margin-top: 1em;">Acknowledgments</h2>
<p>
<div class="text">
 We would like to thank Grace Luo for data, code, and discussion; Loic Landreu and David Picard for insights on geographical representations and diffusion; Karl Doersch, for valuable advice; Sophia Koepke for feedback on our manuscript. Our work, was supported by the HPC resources of IDRIS under the allocation AD011012905R1, AD011012905R2 made by GENCI.
</div>
</p>

<!-- <h4>Font stolen from Gwern.</h4> -->
<script>
  // Add click event listener to each copy code button
  document.querySelectorAll(".copy-code-button").forEach(function(button) {
    button.addEventListener("click", function() {
      // Get the code element
      var codeElement = this.parentElement.querySelector("code");
 
      // Create a temporary textarea to copy the code
      var textarea = document.createElement("textarea");
      textarea.value = codeElement.innerText;
      document.body.appendChild(textarea);
 
      // Select and copy the code
      textarea.select();
      document.execCommand("copy");
 
      // Remove the temporary textarea
      document.body.removeChild(textarea);
 
      // Change the button text to "Copied!" for a short duration
      var originalText = this.innerText;
      this.innerText = "Copied!";
      setTimeout(function() {
        button.innerHTML = "<i class=\"fa-regular fa-clone\"></i>";
      }, 1500);
    });
  });
</script>
</body>
</html>
